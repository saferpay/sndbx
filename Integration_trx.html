<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">

	<link rel="stylesheet" href="assets/css/vendors.css" />
	<link rel="stylesheet" href="assets/css/helppage.css">

	<title>Saferpay documentation | Integration Guide</title>
</head>
<body data-spy="scroll" data-target="#navScrollspy">

	<div id="content" class="container-fluid">
		<div>
			<nav class="hidden-xs hidden-sm hidden-md" id="navScrollspy">
				<div data-spy="affix" class="affix">

					<h3>
						<span style="font-size: x-large; font-weight: bold">Saferpay</span>
						<span class="text-primary">Integration Guide</span>
					</h3>

					<ul class="nav">
							<li>
							<a href="index.html">Introduction</a>
							<ul class="nav">
								<li><a href="#intro-requirement">Requirements</a></li>
								<li><a href="#pci">Data Security and PCI DSS</a></li>
								<li><a href="#3ds">3-D Secure</a></li>
								<li><a href="#dcc">Dynamic Currency Conversion</a></li>
								<li><a href="#version">Versioning</a></li>
								<li><a href="#pm-functions">Payment Method Features</a></li>
								<li><a href="#capture-batch">Capture and Daily Closing</a></li>
								<li><a href="#capture">Capture</a></li>
								<li><a href="#closing">Daily Closing</a></li>
								<li><a href="#special">Special Cases</a></li>
								<li><a href="#reservation">Reservation-Times</a></li>
								<li><a href="#liventesting">Testing and Go Live</a></li>
								<li><a href="#terms">Understanding common Saferpay Terms</a></li>
							</ul>
							</li>
							<li>
							<a href="tls.html">TLS Security and Communication Settings</a>
							</li>
							<li>
							<a href="Interfaces.html">Licenses and Interfaces</a>
							<ul class="nav">
								<li><a href="#interfaces">The Interfaces</a></li>
								<li><a href="#int-paymentmethods">Supported Payment Methods</a></li>
								<li><a href="#int-what">What should i use?</a></li>
								<li><a href="#int-questions">Questions?</a></li>
							</ul>
							</li>
							<li>
							<a href="psd2.html">PSD2</a>
							<ul class="nav">
								<li><a href="#psd2-apply">Does PSD2 apply to me?</a></li>
								<li><a href="#psd2-when">When to do SCA</a></li>
								<li><a href="#psd2-overview">Overview</a></li>
								<li><a href="#psd2-force">When and how to force SCA</a></li>
								<li><a href="#psd2-exemptions">Exemptions</a></li>
								<li><a href="#psd2-special">Special Cases</a></li>
								<li><a href="#psd2-decline">Non Compliance</a></li>
							</ul>
							</li>
							<li>
							<a href="Integration_PP.html">Payment Page Interface</a>
							<ul class="nav">
								<li><a href="#pp-initialize">PaymentPage Initialize</a></li>
								<li><a href="#pp-initialize-response">PaymentPage Initialize Response</a></li>
								<li><a href="#pp-transaction">Redirect and Transaction</a></li>
								<li><a href="#pp-retshop">Return to the Shop</a></li>
								<li><a href="#pp-assert">PaymentPage Assert</a></li>
								<li><a href="#pp-captcancel">Capture or Cancel</a></li>
								<li><a href="#pp-demo">Try it!</a></li>
							</ul>
							</li>
							<li>
							<a href="SaferpayFields.html">Saferpay Fields</a>
							<ul class="nav">
								<li><a href="#hf-flow">Basic Flow</a></li>
								<li><a href="#hf-prep">Preparation</a></li>
								<li><a href="#hf-integration">Integration and Initialization</a></li>
								<li><a href="#hf-class">SaferpayFields - Class functions</a></li>
								<li><a href="#hf-example">Examples</a></li>
								<li><a href="#hf-steps">Further steps</a></li>
							</ul>
							</li>
							<li class="active">
							<a href="Integration_trx.html">Transaction Interface</a>
							<ul class="nav">
								<li><a href="#trx-cc">Credit Cards</a></li>
								<li><a href="#trx-ini">Transaction Initialize</a></li>
								<li><a href="#trx-iframe">RedirectUrl inside iframe</a></li>
								<li><a href="#trx-3ds">3-D Secure and DCC</a></li>
								<li><a href="#trx-retshop">Return to the Shop</a></li>
								<li><a href="#trx-ta">Transaction Authorize</a></li>
								<li><a href="#trx-captcancel">Capture or Cancel</a></li>
								<li><a href="#trx-sepa">SEPA Direct Debit</a></li>
								<li><a href="#trx-demo">Try it!</a></li>
								<li><a href="#trx-post">Using your own HTML-Form</a></li>
							</ul>
							</li>
							<li>
							<a href="scd.html">Secure Card Data</a>
							<ul class="nav">
								<li><a href="#scd-req">Requirements</a></li>
								<li><a href="#scd-payment-methods">Supported Payment Methods</a></li>
								<li><a href="#scd-pp">Secure Card Data and the Payment Page</a></li>
								<li><a href="#scd-trx">Secure Card Data and the Transaction Interface</a></li>
								<li><a href="#scd-sa">Standalone Secure Card Data registration</a></li>
								<li><a href="#scd-post">Using your own HTML-Form</a></li>
								<li><a href="#scd-spg">Secure Card Data and the Secure PayGate</a></li>
								<li><a href="#scd-check">The Check function</a></li>
								<li><a href="#scd-generator">The Id-generator</a></li>
								<li><a href="#scd-use">How to use the obtained data</a></li>
							</ul>
							</li>
							<li>
							<a href="recurring.html">Recurring Payments</a>
							<ul class="nav">
								<li><a href="#recurring-req">Requirements</a></li>
								<li><a href="#recurring-payment-methods">Supported Payment Methods</a></li>
								<li><a href="#recurring-referenced">Referenced  Transactions Method</a></li>
								<li><a href="#recurring-auto">Automating the Recurring Payments</a></li>
							</ul>
							</li>
							<li>
							<a href="refund.html">Refunds via API</a>
							<ul class="nav">
								<li><a href="#refund-req">Requirements</a></li>
								<li><a href="#refund-reference">Method 1: Refernced refunds</a></li>
								<li><a href="#refund-demo">Try it!</a></li>
								<li><a href="#refund-alias">Method 2: Refunds using an alias</a></li>
								<li><a href="#refund-capture">Capture</a></li>
								<li><a href="#refund-cancel">Difference, between Cancel and Refund</a></li>
								<li><a href="#refund-info">Additional information</a></li>
							</ul>
							</li>
							<li>
							<a href="Inquire.html">Inquire Interface</a>
							<ul class="nav">
								<li><a href="#inquire-rules">Rules and limitations</a></li>
								<li><a href="#inquire-examples">Examples</a></li>
							</ul>
							</li>
							<li>
							<a href="app-integration.html">Mobile App integration</a>
							<ul class="nav">
								<li><a href="#mobile-cardprocess">Process</a></li>
								<li><a href="#mobile-alterprocess">3rd Party Payment Methods</a></li>
							</ul>
							</li>
							<li>
							<a href="CssiFrame.html">IFrame Integration and CSS</a>
							<ul class="nav">
								<li><a href="#css-iframe">Iframe Integration</a></li>
								<li><a href="#css-pp">Payment Page</a></li>
								<li><a href="#css-trxini">Transaction Initialize</a></li>
								<li><a href="#css-aliasins">Alias Insert</a></li>
								<li><a href="#css-iframe_size">Size of the Iframe</a></li>
								<li><a href="#css-iframe_support">Iframe Support</a></li>
								<li><a href="#css-usecss">Using CSS</a></li>
								<li><a href="#css-element">CSS Elements</a></li>
								<li><a href="#css-selector">CSS Selectors</a></li>
								<li><a href="#css-info">Additional Info</a></li>
							</ul>
							</li>
							<li>
							<a href="partialcaptures.html">Partial Captures</a>
							<ul class="nav">
								<li><a href="#pc-req">Requirements</a></li>
								<li><a href="#pc-exec">Executing a Multipart Capture</a></li>
								<li><a href="#pc-final">Finalizing a Capture-Chain</a></li>
								<li><a href="#pc-final-why">Why do you need to finalize a transaction?</a></li>
								<li><a href="#pc-refund">Handling Refunds</a></li>
							</ul>
							</li>
							<li>
							<a href="marketplace.html">Marketplace</a>
							<ul class="nav">
								<li><a href="#mark-req">Requirements</a></li>
								<li><a href="#mark-submerchants">Submerchants</a></li>
								<li><a href="#mark-fee">Applying Fees</a></li>
							</ul>
							</li>
							<li>
							<a href="https://docs.saferpay.com/home/interfaces/management-api" target="_blank">Secure PayGate Management Api</a>
							</li>
							<li>
							<a href="fraugster.html">Fraud Intelligence</a>
							<ul class="nav">
								<li><a href="#fire-req">Requirements</a></li>
								<li><a href="#fire-activation">Activation</a></li>
								<li><a href="#fire-training">Training</a></li>
								<li><a href="#fire-data">Datapoints</a></li>
								<li><a href="#fire-rules">Rules</a></li>
								<li><a href="#fire-responses">Responses</a></li>
							</ul>
							</li>
							<li>
							<a href="health.html">API Health Check</a>
							</li>
							<li>
							<a href="mciinstallments.html">Mastercard Issuer Installments</a>
							<ul class="nav">
								<li><a href="#mcii-intro">Introduction</a></li>
								<li><a href="#mcii-req">Prerequisites</a></li>
								<li><a href="#mcii-opt">Receiving installment options</a></li>
								<li><a href="#mcii-plan">Choosing an installment plan</a></li>
								<li><a href="#mcii-test">Test Cards</a></li>
							</ul>
							</li>
							<li>
							<a href="faq.html">FAQ</a>
							</li>
							<li>
							<a href="paymentmeans.html">Payment means for testing</a>
							<ul class="nav">
								<li><a href="#pm-visa">VISA</a></li>
								<li><a href="#pm-mc">Mastercard</a></li>
								<li><a href="#pm-amex">American Express</a></li>
								<li><a href="#pm-diners">Diners Club</a></li>
								<li><a href="#pm-maestro">Maestro international</a></li>
								<li><a href="#pm-jcb">JCB</a></li>
								<li><a href="#pm-myone">My One</a></li>
								<li><a href="#pm-bonus">Bonus Card</a></li>
								<li><a href="#pm-bc">Bancontact</a></li>
								<li><a href="#pm-sepa">SEPA Direct Debit</a></li>
								<li><a href="#pm-paypal">PayPal</a></li>
								<li><a href="#pm-twint">TWINT</a></li>
								<li><a href="#ideal-cards">iDeal</a></li>
								<li><a href="#paydirekt-cards">paydirekt</a></li>
								<li><a href="#unionpay-cards">UnionPay</a></li>
								<li><a href="#postfinance-cards">Postfinance</a></li>
								<li><a href="#applepay-cards">Apple Pay</a></li>
								<li><a href="#klarna-cards">Klarna Payments</a></li>
							</ul>
							</li>
							<li>
								<a><h4>Demo</h4></a>
							</li>
							<li>
							<a href="https://shop.saferpay.eu/saferpayintegration" target="_blank">Saferpay Demo Environment</a>
							</li>
							<li>
								<a><h4>Payment Method specifics</h4></a>
							</li>
							<li>
							<a href="creditcards.html">Credit Cards</a>
							<ul class="nav">
								<li><a href="#cc-pappoval">Partial approvals</a></li>
								<li><a href="#cc-scase">Special Cases</a></li>
							</ul>
							</li>
							<li>
							<a href="Masterpass.html">Masterpass</a>
							<ul class="nav">
								<li><a href="#mp-req">Requirements</a></li>
								<li><a href="#mp-pp">Masterpass via Payment Page</a></li>
								<li><a href="#mp-special">Special Cases</a></li>
							</ul>
							</li>
							<li>
							<a href="Twint.html">TWINT</a>
							<ul class="nav">
								<li><a href="#twint-requirement">Requirements</a></li>
								<li><a href="#twint-general">General specifics</a></li>
								<li><a href="#twint-uof">Twint User on File</a></li>
							</ul>
							</li>
							<li>
							<a href="PayPal.html">PayPal</a>
							<ul class="nav">
								<li><a href="#ppal-requirement">Requirements</a></li>
								<li><a href="#ppal-api-access">Grant API Approval for Saferpay</a></li>
								<li><a href="#ppal-capture">Capture and the solvency of the customer</a></li>
								<li><a href="#ppal-iframe">PayPal iFrame integration</a></li>
								<li><a href="#ppal-special">Other special cases</a></li>
							</ul>
							</li>
							<li>
							<a href="BillPay.html">BillPay</a>
							<ul class="nav">
								<li><a href="#bp-requirement">Requirements</a></li>
								<li><a href="#bp-approval-api">BillPay Certification via API</a></li>
								<li><a href="#bp-assert">Assert</a></li>
								<li><a href="#bp-capt">Capture</a></li>
								<li><a href="#bp-approval-bo">BillPay Certification via Saferpay Backoffice</a></li>
							</ul>
							</li>
							<li>
							<a href="PostFinance.html">Swiss Postcard</a>
							<ul class="nav">
								<li><a href="#pf-requirement">Requirements</a></li>
								<li><a href="#pf-alias">Storage in the Secure Card Data Store</a></li>
								<li><a href="#pf-regdial">Registration Dialogue</a></li>
							</ul>
							</li>
							<li>
							<a href="sofort.html">SOFORT by Klarna</a>
							<ul class="nav">
								<li><a href="#sf-requirement">Requirements</a></li>
								<li><a href="#sf-newproject">Create a new project for SOFORT</a></li>
								<li><a href="#sf-iFrame">Sofort iFrame integration</a></li>
								<li><a href="#sf-refund">SEPA manual Refunds for Sofort</a></li>
							</ul>
							</li>
							<li>
							<a href="KlarnaPayments.html">Klarna Payments</a>
							<ul class="nav">
								<li><a href="#klarna-req">Requirements</a></li>
								<li><a href="#klarna-activation">Activation</a></li>
								<li><a href="#klarna-testing">Testing Period</a></li>
								<li><a href="#klarna-integration">Integration</a></li>
							</ul>
							</li>
							<li>
							<a href="eps.html">eps</a>
							<ul class="nav">
								<li><a href="#eps-requirement">Requirements</a></li>
								<li><a href="#eps-newproject">How toget an EPS acceptance agreement</a></li>
								<li><a href="#eps-refunds">Refunds</a></li>
							</ul>
							</li>
							<li>
							<a href="paydirekt.html">paydirekt</a>
							<ul class="nav">
								<li><a href="#pd-requirement">Requirements</a></li>
								<li><a href="#pd-address">Handling of delivery address</a></li>
								<li><a href="#pd-pending">Display of pending status for bookings</a></li>
								<li><a href="#pd-note">Notification after change from pending to final status</a></li>
								<li><a href="#pd-query">Querying the transaction status</a></li>
								<li><a href="#pd-refund">Refunds</a></li>
							</ul>
							</li>
							<li>
							<a href="ideal.html">iDeal</a>
							<ul class="nav">
								<li><a href="#ideal-requirement">Requirements</a></li>
								<li><a href="#ideal-timeout">Session Timeouts</a></li>
								<li><a href="#ideal-pre">Bank Pre-Selection</a></li>
								<li><a href="#ideal-refund">SEPA manual Refunds for iDeal</a></li>
							</ul>
							</li>
							<li>
							<a href="sepa.html">SEPA</a>
							<ul class="nav">
								<li><a href="#sepa-requirement">Requirements</a></li>
								<li><a href="#sepa-refund">SEPA manual Refunds</a></li>
							</ul>
							</li>
							<li>
							<a href="eprzelewy.md.html">ePrzelewy</a>
							<ul class="nav">
								<li><a href="#przelewy-requirement">Requirements</a></li>
								<li><a href="#przelewy-restrict">Restrictions</a></li>
							</ul>
							</li>
							<li>
							<a href="Alipay.html">Alipay</a>
							<ul class="nav">
								<li><a href="#alipay-requirement">Requirements</a></li>
								<li><a href="#alipay-general">General specifics</a></li>
							</ul>
							</li>
							<li>
							<a href="bancontact.html">Bancontact</a>
							<ul class="nav">
								<li><a href="#bancontact-requirement">Requirements</a></li>
								<li><a href="#bancontact-directmode">Bancontact Direct Mode</a></li>
								<li><a href="#bancontact-refund">Bancontact Refunds</a></li>
							</ul>
							</li>
							<li>
							<a href="applepay.html">ApplePay</a>
							<ul class="nav">
								<li><a href="#apple-requirement">Requirements</a></li>
								<li><a href="#apple-activation">Activation</a></li>
								<li><a href="#apple-redirect">Direct redirect</a></li>
								<li><a href="#apple-tokens">Applepay scheme tokens</a></li>
							</ul>
							</li>
							<li>
							<a href="crypto.html">Crypto Payments</a>
							<ul class="nav">
								<li><a href="#crypto-requirement">Requirements</a></li>
								<li><a href="#crypto-integration">Integration</a></li>
							</ul>
							</li>
							<li>
								<a><h4>Additional Information</h4></a>
							</li>
							<li>
							<a href="https://www.six-payment-services.com/de/site/e-commerce/learn-more/saferpay-blog.html" target="_blank">Saferpay Blog</a>
							</li>
							<li>
							<a href="contact.html">Contact</a>
							</li>
							<li>
							<a href="http://saferpay.github.io/jsonapi/" target="_blank">API Specification</a>
							</li>
							<li>
							<a href="https://saferpay.github.io/changelog/" target="_blank">Changelog</a>
							</li>

					</ul>
				</div>
			</nav>

			<span class="print-page-break"></span>

			<main>
				<div class="hidden-print hidden-lg">
					<div id="navCollapse">

						<button class="menu-btn" type="button" data-toggle="collapse" data-target="#menu-collapse">
							<span class="glyphicon glyphicon-menu-hamburger"></span>
							<h3 style="display: inline-block">
								<span style="font-size: x-large; font-weight: bold">Saferpay</span>
								<span class="text-primary">Integration Guide</span>
							</h3>
						</button>

					</div>

					<ul class="nav collapse" id="menu-collapse">
							<li>
							<a href="index.html">Introduction</a>
							<ul class="nav">
								<li><a href="#intro-requirement">Requirements</a></li>
								<li><a href="#pci">Data Security and PCI DSS</a></li>
								<li><a href="#3ds">3-D Secure</a></li>
								<li><a href="#dcc">Dynamic Currency Conversion</a></li>
								<li><a href="#version">Versioning</a></li>
								<li><a href="#pm-functions">Payment Method Features</a></li>
								<li><a href="#capture-batch">Capture and Daily Closing</a></li>
								<li><a href="#capture">Capture</a></li>
								<li><a href="#closing">Daily Closing</a></li>
								<li><a href="#special">Special Cases</a></li>
								<li><a href="#reservation">Reservation-Times</a></li>
								<li><a href="#liventesting">Testing and Go Live</a></li>
								<li><a href="#terms">Understanding common Saferpay Terms</a></li>
							</ul>
							</li>
							<li>
							<a href="tls.html">TLS Security and Communication Settings</a>
							</li>
							<li>
							<a href="Interfaces.html">Licenses and Interfaces</a>
							<ul class="nav">
								<li><a href="#interfaces">The Interfaces</a></li>
								<li><a href="#int-paymentmethods">Supported Payment Methods</a></li>
								<li><a href="#int-what">What should i use?</a></li>
								<li><a href="#int-questions">Questions?</a></li>
							</ul>
							</li>
							<li>
							<a href="psd2.html">PSD2</a>
							<ul class="nav">
								<li><a href="#psd2-apply">Does PSD2 apply to me?</a></li>
								<li><a href="#psd2-when">When to do SCA</a></li>
								<li><a href="#psd2-overview">Overview</a></li>
								<li><a href="#psd2-force">When and how to force SCA</a></li>
								<li><a href="#psd2-exemptions">Exemptions</a></li>
								<li><a href="#psd2-special">Special Cases</a></li>
								<li><a href="#psd2-decline">Non Compliance</a></li>
							</ul>
							</li>
							<li>
							<a href="Integration_PP.html">Payment Page Interface</a>
							<ul class="nav">
								<li><a href="#pp-initialize">PaymentPage Initialize</a></li>
								<li><a href="#pp-initialize-response">PaymentPage Initialize Response</a></li>
								<li><a href="#pp-transaction">Redirect and Transaction</a></li>
								<li><a href="#pp-retshop">Return to the Shop</a></li>
								<li><a href="#pp-assert">PaymentPage Assert</a></li>
								<li><a href="#pp-captcancel">Capture or Cancel</a></li>
								<li><a href="#pp-demo">Try it!</a></li>
							</ul>
							</li>
							<li>
							<a href="SaferpayFields.html">Saferpay Fields</a>
							<ul class="nav">
								<li><a href="#hf-flow">Basic Flow</a></li>
								<li><a href="#hf-prep">Preparation</a></li>
								<li><a href="#hf-integration">Integration and Initialization</a></li>
								<li><a href="#hf-class">SaferpayFields - Class functions</a></li>
								<li><a href="#hf-example">Examples</a></li>
								<li><a href="#hf-steps">Further steps</a></li>
							</ul>
							</li>
							<li class="active">
							<a href="Integration_trx.html">Transaction Interface</a>
							<ul class="nav">
								<li><a href="#trx-cc">Credit Cards</a></li>
								<li><a href="#trx-ini">Transaction Initialize</a></li>
								<li><a href="#trx-iframe">RedirectUrl inside iframe</a></li>
								<li><a href="#trx-3ds">3-D Secure and DCC</a></li>
								<li><a href="#trx-retshop">Return to the Shop</a></li>
								<li><a href="#trx-ta">Transaction Authorize</a></li>
								<li><a href="#trx-captcancel">Capture or Cancel</a></li>
								<li><a href="#trx-sepa">SEPA Direct Debit</a></li>
								<li><a href="#trx-demo">Try it!</a></li>
								<li><a href="#trx-post">Using your own HTML-Form</a></li>
							</ul>
							</li>
							<li>
							<a href="scd.html">Secure Card Data</a>
							<ul class="nav">
								<li><a href="#scd-req">Requirements</a></li>
								<li><a href="#scd-payment-methods">Supported Payment Methods</a></li>
								<li><a href="#scd-pp">Secure Card Data and the Payment Page</a></li>
								<li><a href="#scd-trx">Secure Card Data and the Transaction Interface</a></li>
								<li><a href="#scd-sa">Standalone Secure Card Data registration</a></li>
								<li><a href="#scd-post">Using your own HTML-Form</a></li>
								<li><a href="#scd-spg">Secure Card Data and the Secure PayGate</a></li>
								<li><a href="#scd-check">The Check function</a></li>
								<li><a href="#scd-generator">The Id-generator</a></li>
								<li><a href="#scd-use">How to use the obtained data</a></li>
							</ul>
							</li>
							<li>
							<a href="recurring.html">Recurring Payments</a>
							<ul class="nav">
								<li><a href="#recurring-req">Requirements</a></li>
								<li><a href="#recurring-payment-methods">Supported Payment Methods</a></li>
								<li><a href="#recurring-referenced">Referenced  Transactions Method</a></li>
								<li><a href="#recurring-auto">Automating the Recurring Payments</a></li>
							</ul>
							</li>
							<li>
							<a href="refund.html">Refunds via API</a>
							<ul class="nav">
								<li><a href="#refund-req">Requirements</a></li>
								<li><a href="#refund-reference">Method 1: Refernced refunds</a></li>
								<li><a href="#refund-demo">Try it!</a></li>
								<li><a href="#refund-alias">Method 2: Refunds using an alias</a></li>
								<li><a href="#refund-capture">Capture</a></li>
								<li><a href="#refund-cancel">Difference, between Cancel and Refund</a></li>
								<li><a href="#refund-info">Additional information</a></li>
							</ul>
							</li>
							<li>
							<a href="Inquire.html">Inquire Interface</a>
							<ul class="nav">
								<li><a href="#inquire-rules">Rules and limitations</a></li>
								<li><a href="#inquire-examples">Examples</a></li>
							</ul>
							</li>
							<li>
							<a href="app-integration.html">Mobile App integration</a>
							<ul class="nav">
								<li><a href="#mobile-cardprocess">Process</a></li>
								<li><a href="#mobile-alterprocess">3rd Party Payment Methods</a></li>
							</ul>
							</li>
							<li>
							<a href="CssiFrame.html">IFrame Integration and CSS</a>
							<ul class="nav">
								<li><a href="#css-iframe">Iframe Integration</a></li>
								<li><a href="#css-pp">Payment Page</a></li>
								<li><a href="#css-trxini">Transaction Initialize</a></li>
								<li><a href="#css-aliasins">Alias Insert</a></li>
								<li><a href="#css-iframe_size">Size of the Iframe</a></li>
								<li><a href="#css-iframe_support">Iframe Support</a></li>
								<li><a href="#css-usecss">Using CSS</a></li>
								<li><a href="#css-element">CSS Elements</a></li>
								<li><a href="#css-selector">CSS Selectors</a></li>
								<li><a href="#css-info">Additional Info</a></li>
							</ul>
							</li>
							<li>
							<a href="partialcaptures.html">Partial Captures</a>
							<ul class="nav">
								<li><a href="#pc-req">Requirements</a></li>
								<li><a href="#pc-exec">Executing a Multipart Capture</a></li>
								<li><a href="#pc-final">Finalizing a Capture-Chain</a></li>
								<li><a href="#pc-final-why">Why do you need to finalize a transaction?</a></li>
								<li><a href="#pc-refund">Handling Refunds</a></li>
							</ul>
							</li>
							<li>
							<a href="marketplace.html">Marketplace</a>
							<ul class="nav">
								<li><a href="#mark-req">Requirements</a></li>
								<li><a href="#mark-submerchants">Submerchants</a></li>
								<li><a href="#mark-fee">Applying Fees</a></li>
							</ul>
							</li>
							<li>
							<a href="https://docs.saferpay.com/home/interfaces/management-api" target="_blank">Secure PayGate Management Api</a>
							</li>
							<li>
							<a href="fraugster.html">Fraud Intelligence</a>
							<ul class="nav">
								<li><a href="#fire-req">Requirements</a></li>
								<li><a href="#fire-activation">Activation</a></li>
								<li><a href="#fire-training">Training</a></li>
								<li><a href="#fire-data">Datapoints</a></li>
								<li><a href="#fire-rules">Rules</a></li>
								<li><a href="#fire-responses">Responses</a></li>
							</ul>
							</li>
							<li>
							<a href="health.html">API Health Check</a>
							</li>
							<li>
							<a href="mciinstallments.html">Mastercard Issuer Installments</a>
							<ul class="nav">
								<li><a href="#mcii-intro">Introduction</a></li>
								<li><a href="#mcii-req">Prerequisites</a></li>
								<li><a href="#mcii-opt">Receiving installment options</a></li>
								<li><a href="#mcii-plan">Choosing an installment plan</a></li>
								<li><a href="#mcii-test">Test Cards</a></li>
							</ul>
							</li>
							<li>
							<a href="faq.html">FAQ</a>
							</li>
							<li>
							<a href="paymentmeans.html">Payment means for testing</a>
							<ul class="nav">
								<li><a href="#pm-visa">VISA</a></li>
								<li><a href="#pm-mc">Mastercard</a></li>
								<li><a href="#pm-amex">American Express</a></li>
								<li><a href="#pm-diners">Diners Club</a></li>
								<li><a href="#pm-maestro">Maestro international</a></li>
								<li><a href="#pm-jcb">JCB</a></li>
								<li><a href="#pm-myone">My One</a></li>
								<li><a href="#pm-bonus">Bonus Card</a></li>
								<li><a href="#pm-bc">Bancontact</a></li>
								<li><a href="#pm-sepa">SEPA Direct Debit</a></li>
								<li><a href="#pm-paypal">PayPal</a></li>
								<li><a href="#pm-twint">TWINT</a></li>
								<li><a href="#ideal-cards">iDeal</a></li>
								<li><a href="#paydirekt-cards">paydirekt</a></li>
								<li><a href="#unionpay-cards">UnionPay</a></li>
								<li><a href="#postfinance-cards">Postfinance</a></li>
								<li><a href="#applepay-cards">Apple Pay</a></li>
								<li><a href="#klarna-cards">Klarna Payments</a></li>
							</ul>
							</li>
							<li>
								<a><h4>Demo</h4></a>
							</li>
							<li>
							<a href="https://shop.saferpay.eu/saferpayintegration" target="_blank">Saferpay Demo Environment</a>
							</li>
							<li>
								<a><h4>Payment Method specifics</h4></a>
							</li>
							<li>
							<a href="creditcards.html">Credit Cards</a>
							<ul class="nav">
								<li><a href="#cc-pappoval">Partial approvals</a></li>
								<li><a href="#cc-scase">Special Cases</a></li>
							</ul>
							</li>
							<li>
							<a href="Masterpass.html">Masterpass</a>
							<ul class="nav">
								<li><a href="#mp-req">Requirements</a></li>
								<li><a href="#mp-pp">Masterpass via Payment Page</a></li>
								<li><a href="#mp-special">Special Cases</a></li>
							</ul>
							</li>
							<li>
							<a href="Twint.html">TWINT</a>
							<ul class="nav">
								<li><a href="#twint-requirement">Requirements</a></li>
								<li><a href="#twint-general">General specifics</a></li>
								<li><a href="#twint-uof">Twint User on File</a></li>
							</ul>
							</li>
							<li>
							<a href="PayPal.html">PayPal</a>
							<ul class="nav">
								<li><a href="#ppal-requirement">Requirements</a></li>
								<li><a href="#ppal-api-access">Grant API Approval for Saferpay</a></li>
								<li><a href="#ppal-capture">Capture and the solvency of the customer</a></li>
								<li><a href="#ppal-iframe">PayPal iFrame integration</a></li>
								<li><a href="#ppal-special">Other special cases</a></li>
							</ul>
							</li>
							<li>
							<a href="BillPay.html">BillPay</a>
							<ul class="nav">
								<li><a href="#bp-requirement">Requirements</a></li>
								<li><a href="#bp-approval-api">BillPay Certification via API</a></li>
								<li><a href="#bp-assert">Assert</a></li>
								<li><a href="#bp-capt">Capture</a></li>
								<li><a href="#bp-approval-bo">BillPay Certification via Saferpay Backoffice</a></li>
							</ul>
							</li>
							<li>
							<a href="PostFinance.html">Swiss Postcard</a>
							<ul class="nav">
								<li><a href="#pf-requirement">Requirements</a></li>
								<li><a href="#pf-alias">Storage in the Secure Card Data Store</a></li>
								<li><a href="#pf-regdial">Registration Dialogue</a></li>
							</ul>
							</li>
							<li>
							<a href="sofort.html">SOFORT by Klarna</a>
							<ul class="nav">
								<li><a href="#sf-requirement">Requirements</a></li>
								<li><a href="#sf-newproject">Create a new project for SOFORT</a></li>
								<li><a href="#sf-iFrame">Sofort iFrame integration</a></li>
								<li><a href="#sf-refund">SEPA manual Refunds for Sofort</a></li>
							</ul>
							</li>
							<li>
							<a href="KlarnaPayments.html">Klarna Payments</a>
							<ul class="nav">
								<li><a href="#klarna-req">Requirements</a></li>
								<li><a href="#klarna-activation">Activation</a></li>
								<li><a href="#klarna-testing">Testing Period</a></li>
								<li><a href="#klarna-integration">Integration</a></li>
							</ul>
							</li>
							<li>
							<a href="eps.html">eps</a>
							<ul class="nav">
								<li><a href="#eps-requirement">Requirements</a></li>
								<li><a href="#eps-newproject">How toget an EPS acceptance agreement</a></li>
								<li><a href="#eps-refunds">Refunds</a></li>
							</ul>
							</li>
							<li>
							<a href="paydirekt.html">paydirekt</a>
							<ul class="nav">
								<li><a href="#pd-requirement">Requirements</a></li>
								<li><a href="#pd-address">Handling of delivery address</a></li>
								<li><a href="#pd-pending">Display of pending status for bookings</a></li>
								<li><a href="#pd-note">Notification after change from pending to final status</a></li>
								<li><a href="#pd-query">Querying the transaction status</a></li>
								<li><a href="#pd-refund">Refunds</a></li>
							</ul>
							</li>
							<li>
							<a href="ideal.html">iDeal</a>
							<ul class="nav">
								<li><a href="#ideal-requirement">Requirements</a></li>
								<li><a href="#ideal-timeout">Session Timeouts</a></li>
								<li><a href="#ideal-pre">Bank Pre-Selection</a></li>
								<li><a href="#ideal-refund">SEPA manual Refunds for iDeal</a></li>
							</ul>
							</li>
							<li>
							<a href="sepa.html">SEPA</a>
							<ul class="nav">
								<li><a href="#sepa-requirement">Requirements</a></li>
								<li><a href="#sepa-refund">SEPA manual Refunds</a></li>
							</ul>
							</li>
							<li>
							<a href="eprzelewy.md.html">ePrzelewy</a>
							<ul class="nav">
								<li><a href="#przelewy-requirement">Requirements</a></li>
								<li><a href="#przelewy-restrict">Restrictions</a></li>
							</ul>
							</li>
							<li>
							<a href="Alipay.html">Alipay</a>
							<ul class="nav">
								<li><a href="#alipay-requirement">Requirements</a></li>
								<li><a href="#alipay-general">General specifics</a></li>
							</ul>
							</li>
							<li>
							<a href="bancontact.html">Bancontact</a>
							<ul class="nav">
								<li><a href="#bancontact-requirement">Requirements</a></li>
								<li><a href="#bancontact-directmode">Bancontact Direct Mode</a></li>
								<li><a href="#bancontact-refund">Bancontact Refunds</a></li>
							</ul>
							</li>
							<li>
							<a href="applepay.html">ApplePay</a>
							<ul class="nav">
								<li><a href="#apple-requirement">Requirements</a></li>
								<li><a href="#apple-activation">Activation</a></li>
								<li><a href="#apple-redirect">Direct redirect</a></li>
								<li><a href="#apple-tokens">Applepay scheme tokens</a></li>
							</ul>
							</li>
							<li>
							<a href="crypto.html">Crypto Payments</a>
							<ul class="nav">
								<li><a href="#crypto-requirement">Requirements</a></li>
								<li><a href="#crypto-integration">Integration</a></li>
							</ul>
							</li>
							<li>
								<a><h4>Additional Information</h4></a>
							</li>
							<li>
							<a href="https://www.six-payment-services.com/de/site/e-commerce/learn-more/saferpay-blog.html" target="_blank">Saferpay Blog</a>
							</li>
							<li>
							<a href="contact.html">Contact</a>
							</li>
							<li>
							<a href="http://saferpay.github.io/jsonapi/" target="_blank">API Specification</a>
							</li>
							<li>
							<a href="https://saferpay.github.io/changelog/" target="_blank">Changelog</a>
							</li>

					</ul>
				</div>

				
<section><h1>Transaction Interface</h1><div class="row"><div class="col-sm-6"><div class="warning" style="min-height: 75px;">
  <span class="glyphicon glyphicon-exclamation-sign" style="color: rgb(240, 169, 43);font-size: 55px;float: left;height: 75px;margin-right: 15px;margin-top: 0px;"></span>
  <p><strong>VERY IMPORTANT:</strong> Before you start integrating this flow, make sure, you have read the <a target="_blank" href="index.html">the Introduction</a> and <a target="_blank" href="interfaces.html">Licenses and Interfaces</a> chapters. They contain general and vital information, not only about the JSON-API, but also for you, the merchant! Furthermore, also make make sure, whether, or not <a href="psd2.html">PSD2</a> does apply to you!</p>
</div><p>The Transaction Interface is an extension to Payment Page Interface intended for a more modular und seamless integration of the payment process and thus offers a wide variety of functions to process and handle payments. It can be operated in parallel with the Payment Page Interface or alone. It offers the <strong>Hosted Entry Form</strong> (HEF) to process <strong>card payments</strong> seamlessly. Please read chapter <a href="https://saferpay.github.io/sndbx/CssiFrame.html#chapter-css-iframe"><strong>Iframe Integration and CSS</strong></a> for examples of the different payment forms. This interface can also be used in combination with Secure Card Data to store/tokenize payment data during the payment process.</p><p>Apart from the processing of payments via the Hosted Entry from, it also offers various functions to process payments without payer interaction which is for example required when performing recurring payments or one click checkouts. The Transaction Interface can also be used to process payments with PCI certification of the levels SAQ-A EP and higher during which the payment data are collected directly be the merchant&#8217;s systems and forwarded to Saferpay.</p><div class="info" style="min-height: 75px;">
  <span class="glyphicon glyphicon-info-sign" style="color: rgb(110, 199, 215);font-size: 55px;height: 75px;float: left;margin-right: 15px;margin-top: 0px;"></span>
  <p><strong>Note:</strong> The JSON API can be used in various ways to cover the most diverse processes. For this reason, only the standard processes are discussed below. For other possible uses, or for questions about the standard procedures, please contact the <a href="https://saferpay.github.io/sndbx/contact.html">Saferpay Integration Team</a></p>
</div><div class="warning" style="min-height: 75px;">
  <span class="glyphicon glyphicon-exclamation-sign" style="color: rgb(240, 169, 43);font-size: 55px;float: left;height: 75px;margin-right: 15px;margin-top: 0px;"></span>
  <p><strong>Attention:</strong> The Transaction Interface is only for holders of a business licence on the live system. For the eCommerce licence, the advanced features are not available. The test accounts have business activated by default, for evaluation purposes.</p>
</div></div></div></section><section><h2>Description of the general process for using the Transaction Interface</h2><div class="row"><div class="col-sm-6"><div class="warning" style="min-height: 75px;">
  <span class="glyphicon glyphicon-exclamation-sign" style="color: rgb(240, 169, 43);font-size: 55px;float: left;height: 75px;margin-right: 15px;margin-top: 0px;"></span>
	<p><strong>Important Note:</strong> The Transaction Interface offers various options to perform transactions. This flow only describes the general flow.</p>
</div><p><img src="https://raw.githubusercontent.com/saferpay/sndbx/master/images/TRX_FlowChart.png" alt="alt text" title="Transaction Interface Flow Chart"></p><ol>
<li><a href="https://saferpay.github.io/jsonapi/#Payment_v1_Transaction_Initialize">Transaction Initialize</a>
<ul>
<li>Initializes the Payment and generates the RedirectUrl for the <a href="https://saferpay.github.io/sndbx/CssiFrame.html">iFrame Integration</a>.</li>
</ul>
</li>
<li>Open the RedirectUrl inside an HTML-iFrame, to show the hosted card entry form.</li>
<li>Return to Return Url depending on the outcome of the 3D Secure procedure. The ReturnUrls are defined in step 1.</li>
<li><a href="https://saferpay.github.io/jsonapi/#Payment_v1_Transaction_Authorize">Transaction Authorize</a>
<ul>
<li>Authorizes the card, which has been gathered in step 2. Up until now, <em>no transaction has been made</em>!</li>
</ul>
</li>
<li>Depending on the outcome of step 4 you may
<ul>
<li><a href="https://saferpay.github.io/jsonapi/#Payment_v1_Transaction_Capture">Capture/Finalize the Transaction</a></li>
<li><a href="https://saferpay.github.io/jsonapi/#Payment_v1_Transaction_Cancel">Cancel/Abort the Transaction</a></li>
</ul>
</li>
<li>Transaction is finished.</li>
</ol></div></div></section><section id="trx-cc"><h2><a name="trx-cc"></a> Credit Cards</h2><div class="row"><div class="col-sm-6"><p>In contrast to the payment page, credit card payments can be seamlessly integrated into the merchant's shop with the Transaction Interface. The procedure will be described in the following.</p></div></div></section><section id="trx-ini"><h3><a name="trx-ini"></a>1 - Transaction Initialize</h3><div class="row"><div class="col-sm-6"><p>The process begins with <a href="https://saferpay.github.io/jsonapi/#Payment_v1_Transaction_Initialize">Transaction Initialize</a>. With this request, you forward all data necessary for the payment to Saferpay. Such as your customer number (CustomerId), the terminal number (Terminal Id), the currency (CurrencyCode), the amount (Value), the internal reference number of the merchant system (OrderId), and the return addresses (ReturnUrls) to which the customer will return, depending on the outcome of the payment.</p></div></div></section><section><h3>Here are a few hints and tips about the options that are available for the merchant:</h3><div class="row"><div class="col-sm-6"><ul>
<li><strong>ReturnUrls:</strong> For security, Saferpay returns no data to return addresses of the shop. The identification of the payment or the returning customers is up to the merchant. We recommend using your own parameters. These can be attached via HTTP GET to the ReturnUrls. When a ReturnUrl is called, Saferpay returns the appended parameter, thus enabling identification of the customer.</li>
</ul><div class="info" style="min-height: 75px;">
  <span class="glyphicon glyphicon-info-sign" style="color: rgb(110, 199, 215);font-size: 55px;height: 75px;float: left;margin-right: 15px;margin-top: 0px;"></span>
  <p>
    <strong>Important:</strong> If you intent on using <a href="index.html#dcc">Dynamic Currency Conversion (DCC)</a>, it is highly recommended to set the Abort Url, even though optional!
  </p>
</div><ul>
<li><p><strong>Payment.OrderId:</strong> This optinal parameter is important to keep track of all your transactions in later processes. This ID will be forwarded, so it will show up inside the Saferpay Backoffice (As the Reference number!) and on your reconciliation-files. This will help associate all the transactions for your accounting-department.</p>
</li>
<li><p><strong>Card Verification Value:</strong> The Card Verification Value (CVC) is mandatory, when using the Card Entry Form, except for card brand Maestro, which offers cards with and without CVC.</p>
</li>
<li><p><strong>Strong Consumer Authentication (SCA):</strong> If a certain transaction needs SCA (please refer to the <a href="psd2.html">PSD2 chapter</a>), you can force SCA, by setting <strong>Authentication.ThreeDsChallenge</strong> to <strong>&quot;FORCE&quot;</strong>.</p>
</li>
<li><p><strong>RedirectNotifyUrls:</strong> These URLs are meant to notify the merchant server, via a server-to-server callback, should the redirect-processes, like 3D Secure be successful, or a failure. Note, that at this point, no transaction has been made. The redirect (see further below in this chapter) only serves the purpose, to perform <a href="index.html#3ds">3D Secure</a> and <a href="index.html#dcc">DCC</a>. The transaction itself is made, with the execution of the transaction authorize request (see further below in this chapter). The notification URLs are meant to circumvent cases, where the redirect to one of the <strong>ReturnUrls</strong> has failed, due to the payer losing connection, or closing the browser preemptively, so the merchant server may continue with the next steps, like the authorization.
&lt;/ br&gt;
The notification happens via http-GET and <strong>does not carry any data (like the token)</strong>, except parameters, that have been added to the URL by the merchant-system. It is intended, that the token (see initialize response) is saved by the merchat system and attached to these parameters, so the merchant system can identify the correct token and perform the authorization this way. Otherwise, the notification callback would be an empty request.
&lt;/ br&gt;
It should be noted that, in a best case scenario, the notification takes place in addition to the respective <strong>ReturnUrl</strong>, due to its redundant nature. Make sure, that your system can handle both calls, so it doesn't interpret them as two separate processes. Moreover, Saferpay expects the merchant server to answer the call with a HTTP status code 200(OK). If no (e.g. a Timeout after 10 seconds), or a different status code (e.g. http 500) is received, Saferpay will re-attempt the notification up to two times more, for a total of three times, to ensure, that the previous error is not caused by a temporal problem.</p>
</li>
<li><p><strong>Saferpay Fields:</strong> When using the <a href="HostedFields.html">Saferpay Fields</a>, you will be provided with a Saferpay Fields token. This token then has to be submitted through transaction/initialize, within the <strong>PaymentMeans.SaferpayFields</strong> container in order to trigger a transaction. If used, the RedirectUrl directly links to the next step e.g. 3D Secure, thus skipping the Hosted Card Entry Form. Think of it as a different method to capture the card data for initialization.</p>
</li>
</ul><pre><code class="language-json">  &quot;PaymentMeans&quot;: {
    &quot;SaferpayFields&quot;: {
      &quot;Token&quot;: &quot;[YOUR TOKEN]&quot;
    },
</code></pre><ul>
<li><a name="trx-hook-scd"></a> <strong>Secure Card Data:</strong> With the Initialize Request, it is also possible within Saferpay Secure Card Data to forward saved cards in the form of an alias. For example, this can be the case if the customers card number has been already saved (tokenized), and you do not want her or him to re-enter this data. To use the alias value instead of the actual card data, use the container PaymentMeans. If used, the RedirectUrl directly links to the next step e.g. 3D Secure, thus skipping the Hosted Card Entry Form.</li>
</ul><pre><code class="language-json">  &quot;PaymentMeans&quot;: {
    &quot;Alias&quot;: {
      &quot;Id&quot;: &quot;[YOUR ALIAS]&quot;
    },
</code></pre><p>Do you want to capture the CVC for an already saved card?
You can eneble this, by submitting:</p><pre><code class="language-json">  &quot;CardForm&quot;: {
    &quot;VerificationCode&quot;: &quot;MANDATORY&quot;
  },
</code></pre><p>With this option set, Saferpay will open up the Hosted Entry Form, while displaying the masked card-number. The card holder can then enter his/her CVC, fully secure and PCI compliant.</p><div class="info" style="min-height: 75px;">
  <span class="glyphicon glyphicon-info-sign" style="color: rgb(110, 199, 215);font-size: 55px;height: 75px;float: left;margin-right: 15px;margin-top: 0px;"></span>
  <p><strong>Tip:</strong> Don't like the style of the Hosted Form? Try our <a target="_blank" href="CssiFrame.html#css-usecss">CSS-Styling feature!</a></p>
</div></div></div></section><section><h3>In the Response of the Initialize Request these parameters are import for further processing:</h3><div class="row"><div class="col-sm-6"><ul>
<li><p><strong>Token:</strong> The <strong>Token</strong> refers to the values temporarily stored regarding the Saferpay transaction and is mandatory during subsequent processing of the transaction (<a href="https://saferpay.github.io/jsonapi/index.html#Payment_v1_Transaction_Authorize">for more information, see e.g. Transaction Authorize</a>). The Token should be coupled to the http-GET parameters that were previously attached to the <strong>ReturnUrls</strong> for identification and then stored inside a database, for further actions to come!</p>
</li>
<li><p><strong>RedirectUrl:</strong> Unlike with the Payment Page, this URL is not intended to be used for a redirect <strong>(Though you may do so, if you want to!)</strong>. Instead, it is embedded in an HTML Iframe. Within this, a form hosted by Saferpay is displayed. This form is also called the Hosted Entry Form. It can be used to capture sensitive card details in a PCI-compliant manner. You can find out more about the Iframe integration <a href="https://saferpay.github.io/sndbx/CssiFrame.html">in this chapter</a>.</p>
</li>
</ul><div class="info" style="min-height: 75px;">
  <span class="glyphicon glyphicon-info-sign" style="color: rgb(110, 199, 215);font-size: 55px;height: 75px;float: left;margin-right: 15px;margin-top: 0px;"></span>
  <p><strong>Note:</strong> If an alias, or Hosted Fields token is forwarded in the initalize request (See the step above!), the display of the form will be skipped. Furthermore, the parameter <strong>Redirect.PaymentmeansRequired</strong> will be false, indicating, that the necessary means of payment already have been provided</p>
</div><div class="info" style="min-height: 75px;">
  <span class="glyphicon glyphicon-info-sign" style="color: rgb(110, 199, 215);font-size: 55px;height: 75px;float: left;margin-right: 15px;margin-top: 0px;"></span>
  <p><strong>Note:</strong> In cases, where a redirect is not necessary, the parameter <strong>RedirectRequired</strong> will be false and no RedirectUrl will be provided. In this case, you can go ahead and proceed with Step #4 - Transaction Authorize.</p>
</div></div></div></section><section id="trx-iframe"><h3><a name="trx-iframe"></a>2 - Open RedirectUrl inside an HTML-iFrame, or Lightbox</h3><div class="row"><div class="col-sm-6"><p>The RedirectUrl should be opened inside an HTML-iFrame embeded in your webshop or application <strong>-a fullsize redirect is technically possible, if desired-</strong>, to show the hosted card entry form. Please view the chapter <a href="https://saferpay.github.io/sndbx/CssiFrame.html#chapter-css-iframe"><strong>Iframe Integration and CSS</strong></a> for more information on the iframe integration and use of CSS to style the hosted entry form.</p><div class="warning" style="min-height: 75px;">
  <span class="glyphicon glyphicon-exclamation-sign" style="color: rgb(240, 169, 43);font-size: 55px;float: left;height: 75px;margin-right: 15px;margin-top: 0px;"></span>
  <p>
    <strong>Important:</strong> Saferpay does not recommend the usage of a Client-Side Session (Cookie), for customer identification, due to restrains emposed by browser manufacturers! Those can cause the Session getting lost, during the payment process, thus causing the shop to not being able to identify the returning user. We recommend using GET-parameters, as described above (See parameter-description for Initialize)!
  </p>
</div><h4><a name="trx-3ds"></a> 3-D Secure and DCC</h4><p>If <a href="https://saferpay.github.io/sndbx/index.html#3ds">3-D Secure</a> and/or <a href="https://saferpay.github.io/sndbx/index.html#dcc">DCC</a> are activated on the terminal for the payment method being used, these services are automatically performed for the transaction as soon as the form has been sent. For this, no additional steps are necessary for the merchant.</p></div></div></section><section id="trx-retshop"><h3><a name="trx-retshop"></a>3 - Return to the Shop</h3><div class="row"><div class="col-sm-6"><p>Once <a href="https://saferpay.github.io/sndbx/index.html#3ds">3-D Secure</a> and/or <a href="https://saferpay.github.io/sndbx/index.html#dcc">DCC</a> are completed, the card holder &#8211; depending on the outcome &#8211; is taken back to one of the <strong>ReturnUrls</strong> of the shop. Here, the GET parameters can be read and the <strong>Token</strong> can be assigned to the transaction. With the <strong>Token</strong>, the payment can be continued to the next step.</p></div></div></section><section id="trx-ta"><h3><a name="trx-ta"></a>4 - Transaction Authorize</h3><div class="row"><div class="col-sm-6"><p>With the Payment Page Interface, the authorization of payment is triggered automatically upon completion of <a href="https://saferpay.github.io/sndbx/index.html#3ds">3-D Secure</a> and/or <a href="https://saferpay.github.io/sndbx/index.html#dcc">DCC</a>. In contrast, with Transaction Interface it is triggered separately via <a href="https://saferpay.github.io/jsonapi/#Payment_v1_Transaction_Authorize">Authorize Request</a>.</p><p><strong>The Transaction Authorize Request offers further possibilities:</strong></p><ul>
<li><p><strong>Condition:</strong> With the <strong>Condition</strong> parameter, it can be specified that a payment will only be authorized when a 3-D Secure liability shift is provided by the cardholders bank.</p>
</li>
<li><p><strong>RegisterAlias:</strong> Via the <strong>RegisterAlias</strong> container, card details from a payment can be stored safely and in conformity with PCI.  <a href="scd.html#scd-trx">See the Secure Card Data chapter</a> for more information.</p>
</li>
</ul><div class="info" style="min-height: 75px;">
  <span class="glyphicon glyphicon-info-sign" style="color: rgb(110, 199, 215);font-size: 55px;height: 75px;float: left;margin-right: 15px;margin-top: 0px;"></span>
  <p><strong>Note:</strong> A card will be registered only after a successful authorization.</p>
</div><p><strong>Transaction Authorize Response data</strong>
In case of success the authorization data is returned with the Transaction Authorize Response. Based on this data, it can be decided how the transaction is to proceed. The following data is interesting in this regard:</p><ul>
<li><p><strong>Transaction &gt; ID:</strong> The transaction identifier (<strong>Id</strong>) returned in the container <strong>Transaction</strong>, is a unique identifier for a transaction. The value is obligatory for further processing steps (Transaction <a href="https://saferpay.github.io/jsonapi/#Payment_v1_Transaction_Capture">Capture</a> or <a href="https://saferpay.github.io/jsonapi/#Payment_v1_Transaction_Cancel">Capture</a>) and should therefore be saved.</p>
</li>
<li><p><strong>ThreeDs:</strong> This container provides information about whether or not transaction liability shift via <a href="https://saferpay.github.io/sndbx/index.html#3ds">3-D Secure</a> is available or not. It is up to merchants whether or not they want to accept transactions without liability shift. Evaluation of the parameter provides the opportunity for merchants to incorporate appropriate rules here.</p>
</li>
</ul><div class="warning" style="min-height: 75px;">
  <span class="glyphicon glyphicon-exclamation-sign" style="color: rgb(240, 169, 43);font-size: 55px;float: left;height: 75px;margin-right: 15px;margin-top: 0px;"></span>
  <p><strong>Important:</strong> Accepting transaction without LiabilityShift happens at the merchants own risk.</p>
</div><ul>
<li><strong>Transaction &gt; Status:</strong> As already described <a href="https://saferpay.github.io/sndbx/index.html#capture-batch">here</a>, this status states whether or not a transaction has to be finalized via <a href="https://saferpay.github.io/jsonapi/#Payment_v1_Transaction_Capture">Capture</a>. If the status is not <strong>CAPTURED</strong>, the capture must be run in order to finalize the transaction.</li>
</ul><div class="info" style="min-height: 75px;">
  <span class="glyphicon glyphicon-info-sign" style="color: rgb(110, 199, 215);font-size: 55px;height: 75px;float: left;margin-right: 15px;margin-top: 0px;"></span>
  <p><strong>Tip:</strong> You can also call <a href="https://saferpay.github.io/jsonapi/index.html#Payment_v1_Transaction_Authorize">Transaction Authorize</a>, if the Fail-or AbortUrl has been called. It will then return a JSON-Object, containing information about the failed transaction, like the reason (If available!) and error-code from the processor itself! Note, that the http-status will be != 200, indicating a failed transaction!</p>
</div></div></div></section><section id="trx-captcancel"><h3><a name="trx-captcancel"></a>5 - Capture or Cancel</h3><div class="row"><div class="col-sm-6"><p>Subsequently, the transaction will be finalised via <a href="https://saferpay.github.io/jsonapi/#Payment_v1_Transaction_Capture"><strong>Capture</strong></a> or aborted via <a href="https://saferpay.github.io/jsonapi/#Payment_v1_Transaction_Cancel"><strong>Cancel</strong></a>.For this, the transaction identifier <strong>Id</strong> is required. Please refer to the notes <a href="index.html#pm-functions">in the payment methods chapter</a>, to check, if and when a <strong>Capture</strong> is necessary, and whether a <strong>Cancel</strong> can still be executed. Once these steps have been executed, the transaction is complete. Alternatively, you can also check the <strong>Transaction.Status</strong> parameter, within the <a href="https://saferpay.github.io/jsonapi/#Payment_v1_Transaction_Authorize">Authorize Response</a>. If the status is <strong>AUTHORIZED</strong> a <a href="https://saferpay.github.io/jsonapi/#Payment_v1_Transaction_Capture">Capture</a> needs to be performed. If the status is <strong>CAPTURED</strong> you do not need to finalize the payment.</p><div class="warning" style="min-height: 75px;">
  <span class="glyphicon glyphicon-exclamation-sign" style="color: rgb(240, 169, 43);font-size: 55px;float: left;height: 75px;margin-right: 15px;margin-top: 0px;"></span>
  <p><strong>VERY IMPORTANT:</strong> Keep in mind that you <strong>cannot cancel</strong> a transaction, once it is captured! At that point, a refund has to be executed, <a href="index.html#pm-functions">if available</a>! So please make sure, that you really want to finalize the transaction and initiate the money transfer, to avoid confusion with your customers!</p>
</div></div></div></section><section id="trx-sepa"><h2><a name="trx-sepa"></a> SEPA Direct Debit</h2><div class="row"><div class="col-sm-6"><p>Because there are no PCI requirements for direct debits, bank details data can be captured directly. The use of an in-house HTML form and the subsequent payment request are allowed. For this, the bank details must be forwarded to <a href="https://saferpay.github.io/jsonapi/#Payment_v1_Transaction_AuthorizeDirect">AuthorizeDirect</a> with the <strong>BankAccount</strong> parameter in the <strong>PaymentMeans</strong> container.</p></div></div></section><section id="trx-demo"><h2><a name="trx-demo"></a> Try it out!</h2><div class="row"><div class="col-sm-6"><p><a class="demobtn" href="https://shop.saferpay.eu/saferpayintegration">Click here for a live demo!</a></p></div></div></section><section id="trx-post"><h2><a name="trx-post"></a> Using your own HTML-Form</h2><div class="row"><div class="col-sm-6"><p>Saferpay also offers the possibility to use a custom HTML-form for merchants with the required PCI certification. The basic transaction-flow stays the same.</p><div class="danger" style="min-height: 75px;">
  <span class="glyphicon glyphicon-remove-sign" style="color: rgb(224, 122, 105);font-size: 55px;height: 75px;float: left;margin-right: 15px;margin-top: 0px;"></span>
  <p><strong>Warning:</strong> As mentioned before: <strong>DO NOT PROCEED</strong>, if you do not have the necessary PCI certification (SAQ-A EP) in order to use your own form! <strong>SIX Payment Services will not take any kind of responsibility in case of a noncompliance! We highly urge you, to use the <a href="HostedFields.html"> Saferpay Hosted Fields</a> instead!</strong></p>
</div></div></div></section><section><h3>The form</h3><div class="row"><div class="col-sm-6"><p>The form-inputs need to be set up in a specific way, so Saferpay can parse the submitted parameters. Please make sure, that you name the inputs in the following way:</p><table class="table table-striped table-hover">
  <thead>
    <tr>
      <th>Parameter</th>
      <th class="text-center">Type</th>
      <th class="text-center">Usage</th>
      <th class="text-center">Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="width: 15%;">RedirectUrl</td>
      <td class="text-center" style="width: 10%;">URL</td>
      <td class="text-center" style="width: 10%;">M</td>
      <td>The redirectUrl you get through <a href="http://saferpay.github.io/jsonapi/index.html#Payment_v1_Transaction_Initialize">Transaction Initialize</a> or <a href="http://saferpay.github.io/jsonapi/index.html#Payment_v1_Alias_Insert">Alias Insert</a>. It has to be set as the form action. The form-method will be POST!</td>     
    </tr>
    <tr>
      <td style="width: 15%;">HolderName</td>
      <td class="text-center" style="width: 10%;">String</td>
      <td class="text-center" style="width: 10%;">M</td>
      <td>Input for the card-holder name.</td>     
    </tr>
    <tr>
      <td style="width: 15%;">CardNumber</td>
      <td class="text-center" style="width: 10%;">String</td>
      <td class="text-center" style="width: 10%;">M</td>
      <td>Input for the card-number (PAN).</td>     
    </tr>
    <tr>
      <td style="width: 15%;">ExpMonth</td>
      <td class="text-center" style="width: 10%;">String</td>
      <td class="text-center" style="width: 10%;">M</td>
      <td>Input for the expiration-month.</td>     
    </tr>
    <tr>
      <td style="width: 15%;">ExpYear</td>
      <td class="text-center" style="width: 10%;">String</td>
      <td class="text-center" style="width: 10%;">M</td>
      <td>Input for the expiration-year.</td>     
    </tr>
    <tr>
      <td style="width: 15%;">VerificationCode</td>
      <td class="text-center" style="width: 10%;">String</td>
      <td class="text-center" style="width: 10%;">M</td>
      <td>Input for the Card Verification Code (CVC).</td>     
    </tr>
    <tr>
      <td style="width: 15%;">FromAjax</td>
      <td class="text-center" style="width: 10%;">Boolean</td>
      <td class="text-center" style="width: 10%;">O</td>
      <td>Set to true, if the form-submission shall be done via AJAX. When used, Saferpay returns validation-messages through a JSON-response, which can be catched with JavaScript!</td>     
    </tr>
  </tbody>
</table></div></div></section><section><h3>Example HTML-form</h3><div class="row"><div class="col-sm-6"><pre><code class="language-html">&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;Credentials-Form&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;h1&gt;Credentials Form&lt;/h1&gt;
    &lt;form method=&quot;POST&quot; action= &quot;&lt;%= RedirectUrl %&gt;&quot;&gt;
      Card Holder
      &lt;input type=&quot;text&quot; name=&quot;HolderName&quot; size=&quot;20&quot;&gt;&lt;br /&gt;
      Card Number
      &lt;input type=&quot;text&quot; name=&quot;CardNumber&quot; size=&quot;16&quot;&gt;&lt;br /&gt;
      Expiration Date
      &lt;input type=&quot;text&quot; name=&quot;ExpMonth&quot; size=&quot;2&quot;&gt;
      &lt;input type=&quot;text&quot; name=&quot;ExpYear&quot; size=&quot;2&quot;&gt;&lt;br /&gt;
      CVC
      &lt;input type=&quot;text&quot; name=&quot;VerificationCode&quot; size=&quot;4&quot;&gt;&lt;br /&gt;
      &lt;input type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;purchase&quot;&gt;
    &lt;/form&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre></div></div></section><section><h3>JavaScript example for AJAX-handling (Requires jQuery 1.9 or higher!)</h3><div class="row"><div class="col-sm-6"><pre><code class="language-javascript">$(&quot;#myForm&quot;).submit(function (e) {
	// prevent normal (non-ajax) formular submission
	e.preventDefault();
 
	var formData = $(this).serializeArray();
	// add flag to ensure AJAX handling on server
	formData.push({ name: &quot;FromAjax&quot;, value: true });
 
	$.post($(this).attr(&quot;action&quot;), $.param(formData))
		// data has been posted successfully and user can be redirected
		.done(function(data, textStatus, jqXHR) {
			// NOTE: data is a json response
			window.location.href = data.RedirectUrl;
		})
		// validation failed or server error occured
		.fail(function(jqXHR, textStatus, errorThrown) {
      // NOTE: use $.parseJSON(jqXHR.responseText) in order to try to get a json response
		});
});

</code></pre></div></div></section><section><h3>Data-response over Ajax</h3><div class="row"><div class="col-sm-6"><h4>Success-Response in case of an http-200 response:</h4><table class="table table-striped table-hover">
  <thead>
    <tr>
      <th>Parameter</th>
      <th class="text-center">Type</th>
      <th class="text-center">Usage</th>
      <th class="text-center">Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="width: 15%;">RedirectUrl</td>
      <td class="text-center" style="width: 10%;">URL</td>
      <td class="text-center" style="width: 10%;">mandatory</td>
      <td>RedirectUrl to which to redirect your customer to!</td>     
    </tr>
  </tbody>
</table><h4>Error-Response in case of an http-4xx response:</h4><table class="table table-striped table-hover">
  <thead>
    <tr>
      <th>Parameter</th>
      <th class="text-center">Type</th>
      <th class="text-center">Usage</th>
      <th class="text-center">Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="width: 15%;">ErrorName</td>
      <td class="text-center" style="width: 10%;">String</td>
      <td class="text-center" style="width: 10%;">mandatory</td>
      <td>Description, or ID of the error</td>     
    </tr>
    <tr>
      <td style="width: 15%;">Behavior</td>
      <td class="text-center" style="width: 10%;">String</td>
      <td class="text-center" style="width: 10%;">mandatory</td>
      <td>Further details on how to proceed (RETRY_LATER, RETRY, ABORT...).</td>     
    </tr>
    <tr>
      <td style="width: 15%;">ErrorDetail</td>
      <td class="text-center" style="width: 10%;">String</td>
      <td class="text-center" style="width: 10%;">optional</td>
      <td>Further details on the error itself, if available. For example, if the ErrorName=VALIDATION_FAILED, the ErrorDetail contains a list of the invalid input-fields (&#8220;CardNumber&#8221;, &#8220;ExpYear&#8221;, &#8220;Ex-pMonth&#8221;, etc.)</td>     
    </tr>
  </tbody>
</table></div></div></section><section><h3>Return to shop</h3><div class="row"><div class="col-sm-6"><p>After the card holder has gone through the 3D Secure and DCC process, he returns to one of the returnUrls.
After that an <a href="http://saferpay.github.io/jsonapi/index.html#Payment_v1_Transaction_Authorize">Authorization</a> can be attempted.</p></div></div></section>

			</main>

		</div>
	</div>

	<div class="scroll-top-wrapper">
		<a href="#top" class="scroll-top-inner" onclick="$('html,body').animate({ scrollTop: 0 }, 'slow'); return false;">
			<span class="glyphicon glyphicon-chevron-up"></span> Back to Top
		</a>
	</div>

	<script src="assets/js/vendors.js"></script>
	<script src="assets/js/helppage.js"></script>
</body>
</html>

